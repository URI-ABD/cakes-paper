\section{Results}
\label{sec:results}


\subsection{Scaling Behavior and Recall}
\label{sec:results:scaling-behavior-and-recall}

Tables~\ref{tab:results:qps-and-recall-fmn}, \ref{tab:results:qps-and-recall-glove}, \ref{tab:results:qps-and-recall-sift}, and \ref{tab:results:qps-and-recall-random} summarize the throughput and recall of CAKES against state-of-the-art $k$-NN search algorithms on the Fashion-MNIST, Glove-25, Sift, and Random datasets respectively.
A recall of $1.000*$ indicates imperfect recall that rounds to $1.000$.

We see that CAKES has perfect recall on all datasets using the Euclidean distance metric, and near-perfect recall on the Glove-25 dataset using Cosine distance.
This is because Cosine distance violates the triangle inequality and is not a metric.
The throughput of CAKES drops slightly for the first two multipliers, but then remains relatively constant as cardinality increases, demonstrating the scalability of CAKES on manifold-structured data.
In contrast, the recall of HNSW and ANNOY degrades significantly as cardinality increases, even though their throughput remains high.
FAISS-IVF keeps high recall but its throughput degrades linearly with cardinality.
For the Random dataset, CAKES again attains perfect recall at all cardinalities, while HNSW and ANNOY exhibit near-zero recall, and FAISS-IVF attains perfect recall but with very low throughput.

On Silva (Fig.~\ref{fig:results:silva-scaling}), all CAKES algorithms initially exhibit throughput that decreases approximately linearly with cardinality, but then level off at higher cardinalities.
DFS is consistently the fastest algorithm on this dataset.

On Radio-ML (Fig.~\ref{fig:results:radioml-scaling}), all CAKES variants are slower than na\"{i}ve linear search, and their throughput decreases linearly with cardinality.


\subsection{Indexing Time}
\label{sec:results:indexing-and-tuning-time}

For each of the ANN-benchmark datasets and Random, Fig.~\ref{fig:results:indexing} reports the time taken for each algorithm to build its index and to tune any hyper-parameters to maximize recall.

\begin{figure}[h]
  \centering
  \vskip -0.2in
  \subfloat[Fashion-MNIST]{
    \includegraphics[width=0.24\textwidth]{images/indexing/fashion-mnist-indexing.png}
    \label{fig:results:fashion-mnist-indexing}
  }
  \subfloat[Glove-25]{=
    \includegraphics[width=0.24\textwidth]{images/indexing/glove-25-indexing.png}
    \label{fig:results:glove-25-indexing}
  }

  \vskip -0.1in
  \subfloat[Sift for $k=10$.]{
    \includegraphics[width=0.24\textwidth]{images/indexing/sift-indexing.png}
    \label{fig:results:sift-indexing}
  }
  \subfloat[Random dataset for $k=10$.]{
    \includegraphics[width=0.24\textwidth]{images/indexing/random-indexing.png}
    \label{fig:results:random-indexing}
  }
  \caption{Indexing and tuning time.
  We report the time taken by various algorithms to build and tune its index on various datasets.
  For CAKES, this includes the time required to build the tree and find the fastest internal algorithm.
  All axes are on logarithmic scales.
  For all datasets, we see that the indexing time for CAKES increases roughly linearly with the cardinality of the dataset.
  HNSW and ANNOY are the slowest at indexing.
  FAISS-Flat does not actually build an index;
  it provides a na\"{i}ve linear search in the FAISS family of algorithms.
  It is included only to illustrate the base cost of simply having a dataset.}
  \label{fig:results:indexing}
\end{figure}

\begin{figure}[h]
  \vskip -0.2in
  \centering
  \subfloat[Silva]{
    \includegraphics[width=0.48\columnwidth]{plots/silva-SSU-Ref_PermutedBall_10_throughput.png}
    \label{fig:results:silva-scaling}
  }
  \subfloat[RadioML at SnR = 10dB.]{
    \includegraphics[width=0.48\columnwidth]{plots/radio-ml_Ball_10_throughput.png}
    \label{fig:results:radioml-scaling}
  }

  \vskip 0.1in
  \includegraphics[width=0.75\columnwidth]{plots/legend.png}

  \vskip -0.1in
  \caption{Throughput vs. dataset cardinality on Silva-18S and Radio-ML.}
  \label{fig:results:scaling-plots}
\end{figure}

\begin{table}[h]
  \centering
  \caption{Fashion-MNIST: throughput and recall.}
  \vskip -0.05in
  \label{tab:results:qps-and-recall-fmn}
  \small
  \setlength{\tabcolsep}{4pt}
  \begin{adjustbox}{width=\columnwidth,center}
  \begin{tabular}{@{} lllllllll @{}}
    \toprule
    \textbf{Mult.} &
    \multicolumn{2}{c}{\textbf{HNSW}} &
    \multicolumn{2}{c}{\textbf{ANNOY}} &
    \multicolumn{2}{c}{\textbf{FAISS-IVF}} &
    \multicolumn{2}{c}{\textbf{CAKES}} \\
    \cmidrule(lr){2-3}\cmidrule(lr){4-5}\cmidrule(lr){6-7}\cmidrule(lr){8-9}
    & QPS & Recall & QPS & Recall & QPS & Recall & QPS & Recall \\
    \midrule
    1   & \num{1.33e4} & 0.954 & \num{2.19e3} & 0.950 & \num{2.01e3} & $1.000^{*}$ & \num{3.46e3} & 1.000 \\
    2   & \num{1.38e4} & 0.803 & \num{2.12e3} & 0.927 & \num{9.39e2} & $1.000^{*}$ & \num{3.68e3} & 1.000 \\
    4   & \num{1.66e4} & 0.681 & \num{2.04e3} & 0.898 & \num{4.61e2} & 0.997       & \num{3.44e3} & 1.000 \\
    8   & \num{1.68e4} & 0.525 & \num{1.93e3} & 0.857 & \num{2.26e2} & 0.995       & \num{3.30e3} & 1.000 \\
    16  & \num{1.87e4} & 0.494 & \num{1.84e3} & 0.862 & \num{1.17e2} & 0.991       & \num{3.34e3} & 1.000 \\
    32  & \num{1.56e4} & 0.542 & \num{1.85e3} & 0.775 & \num{5.91e1} & 0.985       & \num{2.96e3} & 1.000 \\
    64  & \num{1.50e4} & 0.378 & \num{1.78e3} & 0.677 & \num{2.61e1} & 0.968       & \num{3.25e3} & 1.000 \\
    128 & \num{1.49e4} & 0.357 & \num{1.66e3} & 0.538 & \num{1.33e1} & 0.964       & \num{2.96e3} & 1.000 \\
    256 & --           & --    & \num{1.60e3} & 0.592 & \num{6.65e0} & 0.962       & \num{2.79e3} & 1.000 \\
    512 & --           & --    & \num{1.83e3} & 0.581 & \num{3.56e0} & 0.949       & \num{2.84e3} & 1.000 \\
    \bottomrule
  \end{tabular}
  \end{adjustbox}
  \vskip -0.1in
\end{table}

\begin{table}[h]
  \centering
  \caption{Glove-25: throughput and recall.}
  \vskip -0.05in
  \label{tab:results:qps-and-recall-glove}
  \small
  \setlength{\tabcolsep}{4pt}
  \begin{adjustbox}{width=\columnwidth,center}
  \begin{tabular}{@{} lllllllll @{}}
    \toprule
    \textbf{Mult.} &
    \multicolumn{2}{c}{\textbf{HNSW}} &
    \multicolumn{2}{c}{\textbf{ANNOY}} &
    \multicolumn{2}{c}{\textbf{FAISS-IVF}} &
    \multicolumn{2}{c}{\textbf{CAKES}} \\
    \cmidrule(lr){2-3}\cmidrule(lr){4-5}\cmidrule(lr){6-7}\cmidrule(lr){8-9}
    & QPS & Recall & QPS & Recall & QPS & Recall & QPS & Recall \\
    \midrule
    1   & \num{2.28e4} & 0.801 & \num{2.83e3} & 0.835 & \num{2.38e3} & 1.000* & \num{1.54e3} & 1.000* \\
    2   & \num{2.38e4} & 0.607 & \num{2.70e3} & 0.832 & \num{1.19e3} & 1.000* & \num{1.49e3} & 1.000* \\
    4   & \num{2.50e4} & 0.443 & \num{2.61e3} & 0.839 & \num{6.19e2} & 1.000* & \num{1.28e3} & 1.000* \\
    8   & \num{2.78e4} & 0.294 & \num{2.51e3} & 0.834 & \num{3.03e2} & 1.000* & \num{1.30e3} & 1.000* \\
    16  & \num{3.11e4} & 0.213 & \num{2.23e3} & 0.885 & \num{1.51e2} & 1.000* & \num{1.14e3} & 1.000* \\
    32  & \num{3.24e4} & 0.178 & \num{2.01e3} & 0.764 & \num{7.40e1} & 0.999  & \num{1.05e3} & 1.000* \\
    64  & --           & --    & \num{1.99e3} & 0.631 & \num{3.77e1} & 0.997  & \num{1.07e3} & 1.000* \\
    128 & --           & --    & --           & --    & \num{1.90e1} & 0.998  & \num{8.92e2} & 1.000* \\
    256 & --           & --    & --           & --    & \num{9.47e0} & 0.998  & \num{8.91e2} & 1.000* \\
    \bottomrule
  \end{tabular}
  \end{adjustbox}
  \vskip -0.075in
\end{table}


\begin{table}[h]
  \vskip -0.075in
  \centering
  \caption{Sift: throughput and recall.}
  \label{tab:results:qps-and-recall-sift}
  \vskip -0.05in
    \small
    \setlength{\tabcolsep}{4pt}
    \begin{adjustbox}{width=\columnwidth,center}
    \begin{tabular}{@{} lllllllll @{}}
    \toprule
    \textbf{Mult.} &
    \multicolumn{2}{c}{\textbf{HNSW}} &
    \multicolumn{2}{c}{\textbf{ANNOY}} &
    \multicolumn{2}{c}{\textbf{FAISS-IVF}} &
    \multicolumn{2}{c}{\textbf{CAKES}} \\
    \cmidrule(lr){2-3}\cmidrule(lr){4-5}\cmidrule(lr){6-7}\cmidrule(lr){8-9}
    & QPS & Recall & QPS & Recall & QPS & Recall & QPS & Recall \\
    \midrule
    1   & \num{1.93e4} & 0.782 & \num{3.98e3} & 0.686 & \num{6.98e2} & 1.000* & \num{6.20e2} & 1.000 \\
    2   & \num{2.03e4} & 0.552 & \num{3.80e3} & 0.614 & \num{3.30e2} & 1.000* & \num{2.95e2} & 1.000 \\
    4   & \num{2.18e4} & 0.394 & \num{3.69e3} & 0.637 & \num{1.65e2} & 1.000* & \num{1.76e2} & 1.000 \\
    8   & \num{2.48e4} & 0.298 & \num{3.58e3} & 0.710 & \num{7.72e1} & 1.000* & \num{1.27e2} & 1.000 \\
    16  & \num{2.68e4} & 0.210 & \num{3.50e3} & 0.690 & \num{3.98e1} & 1.000* & \num{1.47e2} & 1.000 \\
    32  & \num{2.75e4} & 0.193 & \num{3.44e3} & 0.639 & \num{2.09e1} & 0.999  & \num{1.24e2} & 1.000 \\
    64  & --           & --    & \num{3.39e3} & 0.678 & \num{8.87e0} & 0.997  & \num{1.34e2} & 1.000 \\
    128 & --           & --    & \num{3.36e3} & 0.643 & \num{4.78e0} & 0.993  & \num{1.31e2} & 1.000 \\
    \bottomrule
  \end{tabular}
  \end{adjustbox}
  \vskip -0.1in
\end{table}


\begin{table}[h]
  \vskip -0.1in
  \caption{Random dataset: throughput and recall.}
  \label{tab:results:qps-and-recall-random}
  \vskip -0.05in
  \small
  \setlength{\tabcolsep}{4pt}
  \begin{adjustbox}{width=\columnwidth,center}
  \begin{tabular}{@{} lllllllll @{}}
    \toprule
    \textbf{Mult.} &
    \multicolumn{2}{c}{\textbf{HNSW}} &
    \multicolumn{2}{c}{\textbf{ANNOY}} &
    \multicolumn{2}{c}{\textbf{FAISS-IVF}} &
    \multicolumn{2}{c}{\textbf{CAKES}} \\
    \cmidrule(lr){2-3}\cmidrule(lllllllll){4-5}\cmidrule(lr){6-7}\cmidrule(lr){8-9}
    & QPS & Recall & QPS & Recall & QPS & Recall & QPS & Recall \\
    \midrule
    1  & \num{1.17e4} & 0.060 & \num{4.28e3} & 0.028 & \num{7.342} & 1.000* & \num{6.06e2} & 1.000 \\
    2  & \num{1.01e4} & 0.048 & \num{4.04e3} & 0.021 & \num{3.582} & 1.000* & \num{2.75e2} & 1.000 \\
    4  & \num{9.12e3} & 0.031 & \num{3.64e3} & 0.014 & \num{1.902} & 1.000* & \num{1.35e2} & 1.000 \\
    8  & \num{8.35e3} & 0.022 & \num{3.37e3} & 0.013 & \num{8.841} & 1.000* & \num{6.13e1} & 1.000 \\
    16 & \num{8.25e3} & 0.008 & \num{3.17e3} & 0.006 & \num{4.361} & 1.000* & \num{2.82e1} & 1.000 \\
    32 & --           & --    & \num{3.01e3} & 0.007 & \num{1.721} & 1.000* & \num{1.31e1} & 1.000 \\
    \bottomrule
  \end{tabular}
  \end{adjustbox}
  \vskip -0.1in
\end{table}
